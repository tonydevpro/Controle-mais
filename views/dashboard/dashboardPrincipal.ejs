<%- include('../partials/header', { usuario }) %>
<link rel="stylesheet" href="/css/dashboardPrincipal.css" />

<main class="container">
  <h1>Dashboard - Controle+</h1>

  <!-- SeÃ§Ã£o: Resumo Financeiro -->
  <section class="grid">
    <div class="card destaque">
      <h2>Vendas do Dia</h2>
      <p>R$ <%= vendasDia.toFixed(2) %></p>
    </div>
    <div class="card">
      <h2>Vendas da Semana</h2>
      <p>R$ <%= vendasSemana.toFixed(2) %></p>
    </div>
    <div class="card">
      <h2>Vendas do MÃªs</h2>
      <p>R$ <%= vendasMes.toFixed(2) %></p>
    </div>
    <div class="card verde">
      <h2>Lucro Total</h2>
      <p>R$ <%= lucroTotal.toFixed(2) %></p>
    </div>
    <div class="card">
      <h2>Total de Entradas</h2>
      <p><%= totalEntrada %> un.</p>
    </div>
    <div class="card">
      <h2>Total de SaÃ­das</h2>
      <p><%= totalSaida %> un.</p>
    </div>
  </section>

  <!-- SeÃ§Ã£o: Produtos Mais Vendidos -->
  <section>
    <h2>ðŸ“ˆ Produtos Mais Vendidos</h2>
    <% if (maisVendidos.length > 0) { %>
      <ul class="lista">
        <% maisVendidos.forEach(p => { %>
          <li><strong><%= p.nome %></strong>: <%= p.total_vendido %> vendidos</li>
        <% }) %>
      </ul>
    <% } else { %>
      <p>Nenhuma venda registrada.</p>
    <% } %>
  </section>

  <!-- SeÃ§Ã£o: Estoque -->
  <section class="grid">
    <div class="card azul">
      <h2>Total de Produtos</h2>
      <p><%= totalProdutos %></p>
    </div>
    <div class="card">
      <h2>Estoque Total</h2>
      <p><%= totalEstoque %> un.</p>
    </div>
    <div class="card vermelho">
      <h2>Abaixo do Estoque MÃ­nimo</h2>
      <p><%= abaixoMinimo %></p>
    </div>
    <div class="card laranja">
      <h2>Caixa do Dia</h2>
      <p>Dinheiro: R$ <%= caixa.dinheiro?.toFixed(2) || 0 %><br>
         Pix: R$ <%= caixa.pix?.toFixed(2) || 0 %></p>
    </div>
  </section>

  <!-- SeÃ§Ã£o: Ãšltimas MovimentaÃ§Ãµes -->
  <section>
    <h2>ðŸ“„ Ãšltimas MovimentaÃ§Ãµes</h2>
    <% if (ultimasMovs.length > 0) { %>
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Produto</th>
            <th>Tipo</th>
            <th>Quantidade</th>
            <th>ObservaÃ§Ã£o</th>
          </tr>
        </thead>
        <tbody>
          <% ultimasMovs.forEach(m => { %>
            <tr>
              <td><%= m.data %></td>
              <td><%= m.produto %></td>
              <td><%= m.tipo %></td>
              <td><%= m.quantidade %></td>
              <td><%= m.observacao || '-' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p>Nenhuma movimentaÃ§Ã£o recente.</p>
    <% } %>
  </section>
</main>

<%- include('../partials/footer') %>
